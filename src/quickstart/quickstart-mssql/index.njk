---
layout: base.njk
title: "MS SQL Server CDC Quickstart | CDC: The Missing Manual"
description: "MS SQL Server CDC quickstart: enable CDC, configure SQL Server Agent, set up a connector, verify changes, and roll back safely."
canonicalPath: "/quickstarts/quickstart-mssql/"
permalink: quickstarts/quickstart-mssql/index.html
head_extra: |
  <link rel="stylesheet" href="{{ '/assets/css/pages/quickstart-shared.css' | url }}">
---
{% import "components/ui.njk" as ui %}

{{ ui.hero(heroConfig) | safe }}

<div class="page-wrap prose">
  <section class="box">
    <h2>Prerequisites (DB)</h2>
    <ul class="checklist">
      <li><strong>SQL Server Agent</strong> must be running.</li>
      <li>Database should use <strong>Full Recovery Mode</strong>.</li>
      <li>User needs the <strong>db_owner</strong> fixed database role to enable CDC.</li>
      <li>Tables require a stable primary key or unique index.</li>
      <li>Provision disk for transaction log and CDC change tables.</li>
    </ul>
    <pre><code>-- Is SQL Server Agent running?
EXEC master.dbo.xp_servicecontrol 'QueryState', 'SQLServerAGENT';

-- Recovery model
SELECT name, recovery_model_desc
FROM sys.databases
WHERE name = 'YourDB';</code></pre>
  </section>

  <section class="grid">
    <div class="box">
      <h2>DB Setup (copy/paste)</h2>
      <pre><code>-- Enable CDC on the database
USE YourDB;
GO
EXEC sys.sp_cdc_enable_db;
GO

-- Enable CDC on a specific table
EXEC sys.sp_cdc_enable_table
    @source_schema = N'dbo',
    @source_name   = N'customers',
    @role_name     = N'cdc_role',
    @supports_net_changes = 1;
GO

-- Grant access to the CDC user
CREATE USER cdc WITHOUT LOGIN;
GRANT SELECT ON ALL cdc.change_tables TO cdc;</code></pre>
    </div>
    <div class="box">
      <h2>Connector Config (example)</h2>
      <pre><code>{
  "name": "mssql-cdc",
  "config": {
    "connector.class": "io.debezium.connector.sqlserver.SqlServerConnector",
    "database.hostname": "mssql",
    "database.port": "1433",
    "database.user": "sa",
    "database.password": "Password!",
    "database.dbname": "YourDB",
    "database.server.name": "server1",
    "table.include.list": "dbo.customers",
    "database.history.kafka.bootstrap.servers": "kafka:29092",
    "database.history.kafka.topic": "schema-changes.inventory",
    "tombstones.on.delete": "false",
    "snapshot.mode": "initial"
  }
}</code></pre>
    </div>
  </section>

  <section class="grid">
    <div class="box">
      <h2>Verify</h2>
      <pre><code>-- Check that CDC capture jobs are running
EXEC sys.sp_cdc_help_jobs;

-- Look at the captured changes
SELECT * FROM cdc.dbo_customers_CT;

-- Generate a change
UPDATE dbo.customers SET email = 'new.email@example.com' WHERE id = 1;</code></pre>
      <pre><code># consume from the topic (adjust name)
kafka-console-consumer --bootstrap-server localhost:29092 \
  --topic server1.dbo.customers --from-beginning --max-messages 5</code></pre>
    </div>
    <div class="box">
      <h2>Acceptance (target/sink)</h2>
      <ul class="checklist">
        <li>No duplicate PKs after a connector restart.</li>
        <li>Latest change reflected in the sink using <code>__$start_lsn</code> ordering.</li>
      </ul>
      <pre><code>-- Check for duplicates in the sink
SELECT COUNT(*) AS rows, COUNT(DISTINCT id) AS distinct_keys
FROM target_customers;</code></pre>
    </div>
  </section>

  <section class="box">
    <h2>Safe Rollback / Cleanup</h2>
    <pre><code>-- Stop the connector first!

-- Disable CDC on the table
USE YourDB;
GO
EXEC sys.sp_cdc_disable_table
    @source_schema = N'dbo',
    @source_name   = N'customers',
    @capture_instance = N'all';
GO

-- Disable CDC on the database
EXEC sys.sp_cdc_disable_db;
GO</code></pre>
    <p class="muted">
      Disabling CDC removes the change tables and cleanup jobs, so take a fresh snapshot if you need to re-enable later.
    </p>
  </section>
</div>
