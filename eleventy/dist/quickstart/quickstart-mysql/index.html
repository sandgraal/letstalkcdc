<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MySQL CDC Quickstart | CDC: The Missing Manual</title>
    <meta
      name="description"
      content="MySQL CDC quickstart: prerequisites, connector config, verification, acceptance tests, and rollback."
    />
    <!-- Corrected path for styles.css -->
    <link rel="stylesheet" href="/assets/css/styles.css" />
    <style>
      /* Minimal local styles for page-specific elements */
      .box {
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        padding: 1rem;
        background: var(--color-background-soft);
        margin-bottom: 1.5rem;
      }
      .grid {
        display: grid;
        gap: 1.5rem;
        grid-template-columns: 1fr;
      }
      @media (min-width: 950px) {
        .grid {
          grid-template-columns: 1fr 1fr;
        }
      }
      pre {
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        padding: 0.75rem;
        overflow: auto;
        background: var(--color-background-soft);
      }
      .check {
        list-style: none;
        padding: 0;
        margin: 0.25rem 0 0;
      }
      .check li {
        margin: 0.35rem 0;
      }
      .back-link {
        display: block;
        margin-bottom: 1rem;
        font-weight: 500;
      }
    </style>
    <link
      rel="canonical"
      href="https://letstalkcdc.nfshost.com/quickstart/quickstart-mysql/"
    />
  </head>
  <body>
    <a class="skip-link" href="#main">Skip to content</a>
    <header class="global-header">
      <div class="nav-container">
        <a class="site-title" href="/"
          >CDC: The Missing Manual | A Deep Dive into Change Data Capture</a
        >
        <div class="nav-right">
          <nav aria-label="Primary" class="nav-links">
            <a href="/">Home</a>
            <a href="/overview/" class="active">The Series</a>
          </nav>
          <button
            aria-label="Toggle dark mode"
            class="theme-toggle"
            data-toggle-theme
            type="button"
          >
            üåì
          </button>
        </div>
      </div>
    </header>

    <main id="main" class="prose">
      <a href="/quickstarts.html" class="back-link"
        >‚Üê Back to all Quickstarts</a
      >
      <h1>MySQL CDC ‚Äî Quickstart & Runbook</h1>
      <p class="muted">
        Configure binlog safely, register a connector, verify changes, and roll
        back cleanly.
      </p>

      <section class="box">
        <h2>Prerequisites (DB)</h2>
        <ul class="check">
          <li>
            <strong>binlog_format=ROW</strong>,
            <strong>binlog_row_image</strong> FULL or MINIMAL per connector
            support
          </li>
          <li>GTID mode preferred (<code>gtid_mode=ON</code>)</li>
          <li>Binlog retention window ‚â• snapshot + catch-up time</li>
          <li>
            Stable primary keys (or sink logic that can reconcile keyless
            tables)
          </li>
        </ul>

        <ul class="check">
          <li>
            binlog_format=ROW ensures that individual row changes, not just SQL
            statements, are logged, which is crucial for high-fidelity CDC.
            binlog_row_image=FULL logs the full 'before' and 'after' state of a
            row, while MINIMAL logs only changed columns. gtid_mode=ON is highly
            recommended for resilience and failover, as Global Transaction
            Identifiers uniquely identify transactions across a server farm,
            simplifying replication recovery.
          </li>
        </ul>

        <pre><code>SHOW VARIABLES LIKE 'binlog_format';
SHOW VARIABLES LIKE 'binlog_row_image';
SHOW VARIABLES LIKE 'gtid_mode';
SHOW MASTER STATUS;
SHOW VARIABLES LIKE 'binlog_expire_logs_seconds';</code></pre>
      </section>

      <section class="grid">
        <div class="box">
          <h2>DB Setup (copy/paste)</h2>
          <pre><code># my.cnf (server)
binlog_format = ROW
binlog_row_image = FULL
server_id = 1
gtid_mode = ON
enforce_gtid_consistency = ON

# grant minimal privileges to CDC user
GRANT REPLICATION SLAVE, REPLICATION CLIENT, SELECT ON *.* TO 'cdc'@'%' IDENTIFIED BY 'cdc';</code></pre>
        </div>
        <div class="box">
          <h2>Connector Config (example)</h2>
          <pre><code>{
  "name": "mysql-cdc",
  "config": {
    "connector.class": "io.debezium.connector.mysql.MySqlConnector",
    "database.hostname": "mysql",
    "database.port": "3306",
    "database.user": "cdc",
    "database.password": "cdc",
    "database.server.id": "5400",
    "topic.prefix": "server1",
    "database.include.list": "app",
    "table.include.list": "app.customer",
    "tombstones.on.delete": "false",
    "include.schema.changes": "false",
    "snapshot.mode": "initial",
    "errors.tolerance": "all",
    "errors.deadletterqueue.topic.name": "dlq.mysql"
  }
}</code></pre>
        </div>
      </section>

      <section class="grid">
        <div class="box">
          <h2>Verify</h2>
          <pre><code>-- generate a change
UPDATE app.customer SET email = CONCAT(email,'.x') WHERE id = (SELECT id FROM app.customer LIMIT 1);

-- confirm binlog advancing
SHOW MASTER STATUS;
-- topic should receive a record for app.customer</code></pre>
          <pre><code>kafka-console-consumer --bootstrap-server localhost:29092 \
  --topic server1.app.customer --from-beginning --max-messages 5</code></pre>
        </div>
        <div class="box">
          <h2>Acceptance (target/sink)</h2>
          <ul class="check">
            <li>No duplicate PKs after connector restart</li>
            <li>Latest-wins per key using <code>op_ts/version</code></li>
          </ul>
          <pre><code>SELECT COUNT(*) rows, COUNT(DISTINCT id) distinct_keys FROM target_customers;</code></pre>
        </div>
      </section>

      <section class="box">
        <h2>Safe Rollback</h2>
        <p>
          Stop the connector; keep binlogs until you‚Äôre sure downstream is
          consistent. If you must prune, ensure all consumers are caught up.
        </p>
      </section>
    </main>

    <footer class="site-footer">
      <p>
        ¬© 2025 Christopher Ennis. A deep dive into the world of Change Data
        Capture.
      </p>
    </footer>

    <script type="module">
      // Theme toggle script
      const apply = (m) => (document.documentElement.dataset.theme = m);
      const saved = localStorage.getItem("theme");
      const prefersDark = matchMedia("(prefers-color-scheme: dark)").matches;
      apply(saved ?? (prefersDark ? "dark" : "light"));
      document.addEventListener("click", (e) => {
        if (e.target.matches("[data-toggle-theme]")) {
          const next =
            document.documentElement.dataset.theme === "dark"
              ? "light"
              : "dark";
          apply(next);
          localStorage.setItem("theme", next);
        }
      });
      if (matchMedia("(prefers-reduced-motion: reduce)").matches) {
        document.documentElement.classList.add("reduce-motion");
      }
    </script>
  </body>
</html>
