<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CDC Nuances &amp; Errata ‚Äî Read Before You Ship | </title>
    <meta name="description" content="Corrections, caveats, and sharp edges in CDC systems.">
    <meta name="robots" content="index,follow,max-image-preview:large">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Roboto+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link rel="canonical" href="/errata/">
    <meta name="theme-color" content="#0f172a">
    <meta
      name="description"
      content="Corrections, caveats, and sharp edges in CDC systems."
    />

    <link rel="stylesheet" href="/assets/css/styles.css">
  </head>
  <body>
    <a class="skip-link" href="#main">Skip to content</a>
    <header class="global-header">
      <div class="nav-container">
        <a class="site-title" href="/"></a>
        <div class="nav-right">
          <nav aria-label="Primary" class="nav-links">
            <a class="" href="/">Home</a>
            <a class="" href="/overview/">The Series</a>
          </nav>
          <button aria-label="Toggle dark mode" class="theme-toggle" data-toggle-theme type="button">üåì</button>
        </div>
      </div>
    </header>

    <main id="main"><h1>Nuances & Errata</h1>
      <p class="lede">
        A living list of precise clarifications, corrections, and ‚Äúgotchas‚Äù.
        Treat this as pre‚Äëflight checks before promising
        <em>exactly‚Äëonce</em> or ‚Äúzero data loss.‚Äù
      </p>

      <section class="panel">
        <h2>End‚Äëto‚Äëend <em>exactly‚Äëonce</em> vs. <em>effectively‚Äëonce</em></h2>
        <ul>
          <li>
            <strong>Source connectors are at‚Äëleast‚Äëonce</strong> in practice.
            You can achieve <em>effectively‚Äëonce</em> by making sinks idempotent
            (UPSERT on stable keys) and/or <em>deduplicating</em> using a
            durable <code>event_id</code> ledger.
          </li>
          <li>
            <strong>Transaction boundaries</strong>: Database transactions map
            to change streams, not to sink transactions unless your pipeline
            coordinates them. Don‚Äôt assume cross‚Äëtopic atomicity.
          </li>
          <li>
            <strong>Per‚Äëkey ordering only</strong>: Ordering is guaranteed per
            partition key (primary/business key). <em>Cross‚Äëentity</em> ordering
            is not guaranteed and shouldn‚Äôt be relied upon.
          </li>
        </ul>
      </section>

      <section class="panel">
        <h2>Snapshots, backfills, and replays</h2>
        <ul>
          <li>
            <strong>Initial snapshots</strong> can interleave with live changes;
            design consumers to reconcile using version columns or
            <code>op_ts</code>.
          </li>
          <li>
            <strong>Incremental snapshots</strong> (signal‚Äëbased) are powerful
            but can produce duplicates; always merge on keys + highest version
            and keep idempotent sinks.
          </li>
          <li>
            <strong>Backfills</strong> are just another snapshot; isolate them
            (topics/headers) to avoid double‚Äëcounting.
          </li>
        </ul>
      </section>

      <section class="panel">
        <h2>Tombstones, compaction, and deletions</h2>
        <ul>
          <li>
            <strong>Tombstones</strong> are required for compaction to fully
            remove keys; keep a non‚Äëzero delete.retention.ms long enough for
            consumers.
          </li>
          <li>
            <strong>Soft‚Äëdelete models</strong> still need physical deletes or a
            retention strategy in the sink to avoid data resurrection.
          </li>
        </ul>
      </section>

      <section class="panel">
        <h2>Schema evolution</h2>
        <ul>
          <li>
            Always version <em>payload schemas</em> and keep consumers tolerant
            to <em>additive</em> changes. No producer should introduce breaking
            field removals/renames without a migration window.
          </li>
          <li>
            Use <code>optional</code> + default values judiciously to avoid
            ‚Äúpoison‚Äù events.
          </li>
        </ul>
      </section>

      <section class="panel">
        <h2>Operational guardrails</h2>
        <ul>
          <li>
            Watch lag/throughput and <code>max.queue.size</code>,
            <code>max.batch.size</code>, <code>poll.interval.ms</code>.
            Oversizing queue without heap tuning yields GC stalls.
          </li>
          <li>
            Alert on <strong>connector task failures</strong>,
            <strong>restart loops</strong>, and
            <strong>earliest‚Äëoffset resets</strong>.
          </li>
          <li>
            Prefer <strong>per‚Äëtable connectors</strong> for isolation when SLAs
            differ; otherwise group by SLA and update cadence.
          </li>
        </ul>
      </section>

      <section class="panel">
        <h2>Recommended dedup ledger</h2>
        <pre><code>-- event_id is a stable UUID in headers or payload
create table if not exists dw.processed_event(
  event_id text primary key,
  processed_at timestamptz not null default now()
);</code></pre>
        <p>On ingest:</p>
        <pre><code>insert into dw.processed_event(event_id)
values (:event_id)
on conflict do nothing;</code></pre>
      </section>

      <div class="links" aria-label="useful extras">
        <a href="compose.yaml" download>compose.yaml</a>
        <a href="connectors/postgres-inventory.json" download
          >postgres sample connector</a
        >
        <a href="scripts/register_connector.sh" download
          >register connector script</a
        >
      </div>
</main>

    <script type="module">
      const applyTheme = (mode) => {
        document.documentElement.dataset.theme = mode;
      };
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = matchMedia('(prefers-color-scheme: dark)').matches;
      applyTheme(savedTheme ?? (prefersDark ? 'dark' : 'light'));
      document.addEventListener('click', (event) => {
        if (event.target.matches('[data-toggle-theme]') || event.target.closest('[data-toggle-theme]')) {
          const next = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
          applyTheme(next);
          localStorage.setItem('theme', next);
        }
      });
      if (matchMedia('(prefers-reduced-motion: reduce)').matches) {
        document.documentElement.classList.add('reduce-motion');
      }
      document.querySelectorAll('.prose h2, .prose h3').forEach((heading) => {
        const slug = heading.id || heading.textContent.toLowerCase().trim().replace(/[^a-z0-9]+/g, '-');
        heading.id = slug;
        const anchor = Object.assign(document.createElement('a'), {
          href: `#${slug}`,
          className: 'anchor',
          ariaLabel: 'Link to section'
        });
        heading.appendChild(anchor);
      });
      document.querySelectorAll('pre > code').forEach((code) => {
        const pre = code.parentElement;
        const button = Object.assign(document.createElement('button'), {
          textContent: 'Copy',
          className: 'theme-toggle'
        });
        pre.style.position = 'relative';
        pre.appendChild(button);
        button.addEventListener('click', async () => {
          await navigator.clipboard.writeText(code.innerText);
          button.textContent = 'Copied!';
          setTimeout(() => (button.textContent = 'Copy'), 1200);
        });
      });
    </script>
    <script type="module" src="/assets/js/app.js"></script>
    <script src="app.js" defer></script>

    <footer class="site-footer">
      <p></p>
    </footer>
  </body>
</html>
